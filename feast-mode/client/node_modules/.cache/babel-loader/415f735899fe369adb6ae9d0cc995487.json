{"ast":null,"code":"'use strict';\n\nvar MenuItem = require('./MenuItem');\n\nvar MenuCategory = require('./MenuCategory');\n\nvar Menu = function (menuData) {\n  if (!menuData) {\n    menuData = {};\n  } else {\n    this.parseMenu(menuData);\n  }\n\n  this.menuData = menuData;\n};\n\nMenu.prototype.getRaw = function () {\n  return this.menuData;\n};\n\nMenu.prototype.buildCategories = function (categoryData, parent) {\n  var category = new MenuCategory(categoryData, parent);\n\n  for (var subIndex in categoryData.Categories) {\n    category.getSubcategories().push(this.buildCategories(categoryData.Categories[subIndex], category));\n  }\n\n  categoryData.Products.forEach(function (productCode) {\n    //link up products and categories\n    var product = this.menuByCode[productCode];\n\n    if (!product) {\n      console.log(\"PRODUCT NOT FOUND: \" + productCode, category.getCode());\n      return;\n    }\n\n    category.getProducts().push(product);\n    product.getCategories().push(category);\n  }.bind(this));\n  return category;\n};\n\nMenu.prototype.parseItems = function (parentMenuData, ParseClass) {\n  var items = [];\n  Object.keys(parentMenuData).forEach(function (code) {\n    var menuData = parentMenuData[code];\n    var obj = new ParseClass(menuData);\n    this.menuByCode[obj.getCode()] = obj;\n    items.push(obj);\n  }.bind(this));\n  return items;\n};\n\nMenu.prototype.parseMenu = function (menuData) {\n  this.menuByCode = {};\n  var products = this.parseItems(menuData.result.Products, MenuItem);\n  var coupons = this.parseItems(menuData.result.Coupons, MenuItem);\n  var preconfigured = this.parseItems(menuData.result.PreconfiguredProducts, MenuItem);\n  this.rootCategories = {}; //generate category tree using MenuCategory objects\n\n  for (var categoryType in menuData.result.Categorization) {\n    var categoryData = menuData.result.Categorization[categoryType];\n    this.rootCategories[categoryType] = this.buildCategories(categoryData);\n  }\n};\n\nMenu.prototype.getFoodCategory = function () {\n  return this.rootCategories[\"Food\"];\n};\n\nMenu.prototype.getCouponCategory = function () {\n  return this.rootCategories[\"Coupons\"];\n};\n\nMenu.prototype.getPreconfiguredCategory = function () {\n  return this.rootCategories[\"PreconfiguredProducts\"];\n};\n\nMenu.prototype.getItemByCode = function (code) {\n  return this.menuByCode[code];\n};\n\nmodule.exports = Menu;","map":null,"metadata":{},"sourceType":"script"}