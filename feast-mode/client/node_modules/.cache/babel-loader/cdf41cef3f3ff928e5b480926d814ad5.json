{"ast":null,"code":"'use strict';\n\nvar urls = require('./urls.json');\n\nvar httpJson = require('./http-json');\n\nvar util = require('util');\n\nvar Order = function (parameters) {\n  if (!parameters) {\n    parameters = {};\n  } //default order\n\n\n  this.Address = '';\n  this.Coupons = [];\n  this.CustomerID = '';\n  this.Email = '';\n  this.Extension = '';\n  this.FirstName = '';\n  this.LastName = '';\n  this.LanguageCode = 'en';\n  this.OrderChannel = 'OLO';\n  this.OrderID = '';\n  this.OrderMethod = 'Web';\n  this.OrderTaker = null;\n  this.Payments = [];\n  this.Phone = '';\n  this.Products = [];\n  this.Market = '';\n  this.Currency = '';\n  this.ServiceMethod = parameters.deliveryMethod || 'Delivery';\n  this.SourceOrganizationURI = urls.sourceUri;\n  this.StoreID = parameters.storeID || '';\n  this.Tags = {};\n  this.Version = '1.0';\n  this.NoCombine = true;\n  this.Partners = {};\n  this.NewUser = true;\n  this.metaData = {};\n  this.Amounts = {};\n  this.BusinessDate = '';\n  this.EstimatedWaitMinutes = '';\n  this.PriceOrderTime = '';\n  this.AmountsBreakdown = '';\n\n  if (parameters['customer']) {\n    var Customer = parameters.customer;\n    this.Address = Customer.address;\n    this.CustomerID = Customer.ID;\n    this.Email = Customer.email;\n    this.FirstName = Customer.firstName;\n    this.LastName = Customer.lastName;\n    this.Phone = Customer.phone;\n    return this;\n  }\n\n  if (parameters['Order'] || parameters['order']) {\n    //Used to initialize order object from Dominos results (Also handy for initializing from DB)\n    var prevOrder = parameters.Order;\n    var Customer = parameters.customer;\n    this.Address = Customer ? Customer.address ? Customer.address : prevOrder.Address : prevOrder.Address;\n    this.CustomerID = Customer ? Customer.address ? Customer.ID : prevOrder.CustomerID : prevOrder.CustomerID;\n    this.Email = Customer ? Customer.address ? Customer.email : prevOrder.Email : prevOrder.Email;\n    this.FirstName = Customer ? Customer.address ? Customer.firstName : prevOrder.FirstName : prevOrder.FirstName;\n    this.LastName = Customer ? Customer.address ? Customer.lastName : prevOrder.LastName : prevOrder.LastName;\n    this.OrderID = prevOrder.OrderID;\n    this.Products = prevOrder.Products;\n    this.Market = prevOrder.Market;\n    this.Currency = prevOrder.Currency;\n    this.StoreID = prevOrder.StoreID;\n    this.Amounts = prevOrder.Amounts || {};\n    this.BusinessDate = prevOrder.BusinessDate || '';\n    this.EstimatedWaitMinutes = prevOrder.EstimatedWaitMinutes || '';\n    this.PriceOrderTime = prevOrder.PriceOrderTime || '';\n    this.AmountsBreakdown = prevOrder.AmountsBreakdown || {};\n    return this;\n  }\n};\n\nOrder.prototype.addCoupon = function (Coupon) {\n  //Add coupon to Order\n  this.Coupons.push(Coupon);\n};\n\nOrder.prototype.removeCoupon = function (Coupon) {\n  //Remove coupon from Order\n  var index = this.Coupons.indexOf(Coupon);\n\n  if (index != -1) {\n    this.Coupons.splice(index, 1);\n  }\n};\n\nOrder.prototype.addItem = function (Item) {\n  //Add product to Order\n  this.Products.push(Item);\n};\n\nOrder.prototype.removeItem = function (Item) {\n  //Remove product from Order\n  var index = this.Products.indexOf(Item);\n\n  if (index != -1) {\n    this.Products.splice(index, 1);\n  }\n};\n\nOrder.prototype.validate = function (callback) {\n  //Validate Order\n  if (!this.Products || !callback) {\n    if (callback) {\n      callback({\n        success: false,\n        message: 'At least one Item must be added!'\n      });\n    }\n\n    return;\n  } //Blame Dominos, this isn't my doing.\n\n\n  var stringified = JSON.stringify({\n    'Order': this\n  });\n  httpJson.post(urls.order.validate, stringified, this.mergeResponse.bind(this, callback));\n};\n\nOrder.prototype.price = function (callback) {\n  if (!this.Products || !callback) {\n    if (callback) {\n      callback({\n        success: false,\n        message: 'At least one Item must be added!'\n      });\n    }\n\n    return;\n  }\n\n  var stringified = JSON.stringify({\n    'Order': this\n  });\n  httpJson.post(urls.order.price, stringified, this.mergeResponse.bind(this, callback));\n};\n\nOrder.prototype.place = function (callback) {\n  if (!this.Products || !callback) {\n    if (callback) {\n      callback({\n        success: false,\n        message: 'At least one product must be added!'\n      });\n    }\n  }\n\n  var stringified = JSON.stringify({\n    'Order': this\n  });\n  httpJson.post(urls.order.place, stringified, callback);\n};\n\nOrder.prototype.mergeResponse = function (callback, response) {\n  for (var key in response.result.Order) {\n    if (util.isArray(response.result.Order[key]) && !response.result.Order[key].length) {\n      continue;\n    }\n\n    this[key] = response.result.Order[key];\n  } //console.log(util.inspect(this.Products, { showHidden: true, depth: 5 }));\n\n\n  if (callback) {\n    callback(response);\n  }\n};\n\nOrder.prototype.validateCC = function (number) {\n  var re = {\n    visa: /^4[0-9]{12}(?:[0-9]{3})?$/,\n    mastercard: /^5[1-5][0-9]{14}$/,\n    amex: /^3[47][0-9]{13}$/,\n    diners: /^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,\n    discover: /^6(?:011|5[0-9]{2})[0-9]{12}$/,\n    jcb: /^(?:2131|1800|35\\d{3})\\d{11}$/,\n    enroute: /^(?:2014|2149)\\d{11}$/\n  };\n  if (re.visa.test(number)) return 'VISA';\n  if (re.mastercard.test(number)) return 'MASTERCARD';\n  if (re.amex.test(number)) return 'AMEX';\n  if (re.diners.test(number)) return 'DINERS';\n  if (re.discover.test(number)) return 'DISCOVER';\n  if (re.jcb.test(number)) return 'JCB';\n  if (re.enroute.test(number)) return 'JCB';\n  return \"\";\n};\n\nOrder.prototype.PaymentObject = function () {\n  Object.defineProperties(this, {\n    \"Type\": {\n      writable: false,\n      enumerable: true,\n      value: \"CreditCard\"\n    },\n    \"Amount\": {\n      writable: true,\n      enumerable: true,\n      value: 0\n    },\n    \"Number\": {\n      writable: true,\n      enumerable: true,\n      value: \"\"\n    },\n    \"CardType\": {\n      writable: true,\n      enumerable: true,\n      value: \"\" //uppercase\n\n    },\n    \"Expiration\": {\n      writable: true,\n      enumerable: true,\n      value: \"\" //digits only\n\n    },\n    \"SecurityCode\": {\n      writable: true,\n      enumerable: true,\n      value: \"\"\n    },\n    \"PostalCode\": {\n      writable: true,\n      enumerable: true,\n      value: \"\"\n    }\n  });\n};\n\nmodule.exports = Order;","map":{"version":3,"sources":["/Users/cssummer19/Documents/FeastMode/feast-mode/src/dominos/src/Order.js"],"names":["urls","require","httpJson","util","Order","parameters","Address","Coupons","CustomerID","Email","Extension","FirstName","LastName","LanguageCode","OrderChannel","OrderID","OrderMethod","OrderTaker","Payments","Phone","Products","Market","Currency","ServiceMethod","deliveryMethod","SourceOrganizationURI","sourceUri","StoreID","storeID","Tags","Version","NoCombine","Partners","NewUser","metaData","Amounts","BusinessDate","EstimatedWaitMinutes","PriceOrderTime","AmountsBreakdown","Customer","customer","address","ID","email","firstName","lastName","phone","prevOrder","prototype","addCoupon","Coupon","push","removeCoupon","index","indexOf","splice","addItem","Item","removeItem","validate","callback","success","message","stringified","JSON","stringify","post","order","mergeResponse","bind","price","place","response","key","result","isArray","length","validateCC","number","re","visa","mastercard","amex","diners","discover","jcb","enroute","test","PaymentObject","Object","defineProperties","writable","enumerable","value","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar urls = require('./urls.json');\nvar httpJson = require('./http-json');\nvar util=require('util');\n\nvar Order = function(parameters) {\n  if(!parameters){\n      parameters={}\n  }\n  //default order\n  this.Address = '';\n  this.Coupons = [];\n  this.CustomerID = '';\n  this.Email = '';\n  this.Extension = '';\n  this.FirstName = '';\n  this.LastName = '';\n  this.LanguageCode = 'en';\n  this.OrderChannel = 'OLO';\n  this.OrderID = '';\n  this.OrderMethod = 'Web';\n  this.OrderTaker = null;\n  this.Payments = [];\n  this.Phone = '';\n  this.Products = [];\n  this.Market = '';\n  this.Currency = '';\n  this.ServiceMethod = parameters.deliveryMethod || 'Delivery';\n  this.SourceOrganizationURI = urls.sourceUri;\n  this.StoreID = parameters.storeID||'';\n  this.Tags = {};\n  this.Version = '1.0';\n  this.NoCombine = true;\n  this.Partners = {};\n  this.NewUser = true;\n  this.metaData = {};\n  this.Amounts = {};\n  this.BusinessDate = '';\n  this.EstimatedWaitMinutes = '';\n  this.PriceOrderTime = '';\n  this.AmountsBreakdown = '';\n\n  if(parameters['customer']) {\n    var Customer = parameters.customer;\n\n    this.Address = Customer.address;\n    this.CustomerID = Customer.ID;\n    this.Email = Customer.email;\n    this.FirstName = Customer.firstName;\n    this.LastName = Customer.lastName;\n    this.Phone = Customer.phone;\n    return this;\n  }\n  if(parameters['Order'] || parameters['order']) {  //Used to initialize order object from Dominos results (Also handy for initializing from DB)\n    var prevOrder = parameters.Order;\n    var Customer = parameters.customer;\n\n    this.Address = (Customer)? (\n        (Customer.address)? Customer.address : prevOrder.Address\n    ):prevOrder.Address;\n\n    this.CustomerID = (Customer)? (\n        (Customer.address)? Customer.ID : prevOrder.CustomerID\n    ):prevOrder.CustomerID;\n\n    this.Email = (Customer)? (\n        (Customer.address)? Customer.email : prevOrder.Email\n    ):prevOrder.Email;\n\n    this.FirstName = (Customer)? (\n        (Customer.address)? Customer.firstName : prevOrder.FirstName\n    ):prevOrder.FirstName;\n\n    this.LastName = (Customer)? (\n        (Customer.address)? Customer.lastName : prevOrder.LastName\n    ):prevOrder.LastName;\n\n    this.OrderID = prevOrder.OrderID;\n    this.Products = prevOrder.Products;\n    this.Market = prevOrder.Market;\n    this.Currency = prevOrder.Currency;\n    this.StoreID = prevOrder.StoreID;\n    this.Amounts = prevOrder.Amounts || {};\n    this.BusinessDate = prevOrder.BusinessDate || '';\n    this.EstimatedWaitMinutes = prevOrder.EstimatedWaitMinutes || '';\n    this.PriceOrderTime = prevOrder.PriceOrderTime || '';\n    this.AmountsBreakdown = prevOrder.AmountsBreakdown || {};\n\n    return this;\n  }\n};\n\nOrder.prototype.addCoupon = function(Coupon) { //Add coupon to Order\n    this.Coupons.push(Coupon)\n};\n\nOrder.prototype.removeCoupon = function(Coupon) { //Remove coupon from Order\n    var index = this.Coupons.indexOf(Coupon);\n    if (index != -1) {\n        this.Coupons.splice(index, 1);\n    }\n};\n\nOrder.prototype.addItem = function(Item) { //Add product to Order\n    this.Products.push(Item)\n};\n\nOrder.prototype.removeItem = function(Item) {  //Remove product from Order\n  var index = this.Products.indexOf(Item);\n  if(index != -1) {\n    this.Products.splice(index, 1);\n  }\n};\n\nOrder.prototype.validate = function(callback) {  //Validate Order\n  if(!this.Products || !callback) {\n    if(callback) {\n      callback({\n        success: false,\n        message: 'At least one Item must be added!'\n      });\n    }\n    return;\n  }\n\n  //Blame Dominos, this isn't my doing.\n  var stringified = JSON.stringify({\n    'Order' : this\n  });\n\n  httpJson.post(urls.order.validate, stringified, this.mergeResponse.bind(this,callback));\n};\n\nOrder.prototype.price = function(callback) {\n  if(!this.Products || !callback) {\n    if(callback) {\n      callback({\n        success: false,\n        message: 'At least one Item must be added!'\n      });\n    }\n    return;\n  }\n\n  var stringified = JSON.stringify({\n    'Order' : this\n  });\n\n  httpJson.post(urls.order.price, stringified, this.mergeResponse.bind(this,callback));\n};\n\nOrder.prototype.place = function(callback) {\n  if(!this.Products || !callback) {\n      if(callback) {\n          callback({\n              success: false,\n              message: 'At least one product must be added!'\n          })\n      }\n  }\n\n  var stringified = JSON.stringify({\n    'Order' : this\n  });\n\n  httpJson.post(urls.order.place, stringified, callback);\n};\n\nOrder.prototype.mergeResponse = function(callback,response){\n    for(var key in response.result.Order){\n        if(util.isArray(response.result.Order[key])&&!response.result.Order[key].length){\n            continue;\n        }\n        this[key]=response.result.Order[key];\n    }\n    //console.log(util.inspect(this.Products, { showHidden: true, depth: 5 }));\n    if(callback){\n        callback(response);\n    }\n}\n\nOrder.prototype.validateCC=function(number){\n    var re = {\n        visa        : /^4[0-9]{12}(?:[0-9]{3})?$/,\n        mastercard  : /^5[1-5][0-9]{14}$/,\n        amex        : /^3[47][0-9]{13}$/,\n        diners      : /^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,\n        discover    : /^6(?:011|5[0-9]{2})[0-9]{12}$/,\n        jcb         : /^(?:2131|1800|35\\d{3})\\d{11}$/,\n        enroute     : /^(?:2014|2149)\\d{11}$/\n    };\n\n    if (re.visa.test(number))\n        return 'VISA';\n\n    if (re.mastercard.test(number))\n        return 'MASTERCARD';\n\n    if (re.amex.test(number))\n        return 'AMEX';\n\n    if (re.diners.test(number))\n        return 'DINERS';\n\n    if (re.discover.test(number))\n        return 'DISCOVER';\n\n    if (re.jcb.test(number))\n        return 'JCB';\n\n    if (re.enroute.test(number))\n        return 'JCB';\n\n    return \"\";\n}\n\nOrder.prototype.PaymentObject=function(){\n    Object.defineProperties(\n        this,\n        {\n            \"Type\": {\n                writable:false,\n                enumerable:true,\n                value:\"CreditCard\"\n            },\n            \"Amount\":  {\n                writable:true,\n                enumerable:true,\n                value:0\n            },\n            \"Number\":  {\n                writable:true,\n                enumerable:true,\n                value:\"\"\n            },\n            \"CardType\":  {\n                writable:true,\n                enumerable:true,\n                value:\"\"//uppercase\n            },\n            \"Expiration\":  {\n                writable:true,\n                enumerable:true,\n                value:\"\"//digits only\n            },\n            \"SecurityCode\":  {\n                writable:true,\n                enumerable:true,\n                value:\"\"\n            },\n            \"PostalCode\":  {\n                writable:true,\n                enumerable:true,\n                value:\"\"\n            }\n        }\n    );\n}\n\nmodule.exports = Order;\n"]},"metadata":{},"sourceType":"module"}