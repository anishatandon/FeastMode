{"ast":null,"code":"'use strict';\n\nvar httpJson = require('./http-json');\n\nvar urls = require('./urls.json');\n\nvar util = require('util');\n\nvar fs = require('fs');\n\nvar Menu = require('./Menu.js');\n\nvar Store = function (parameters) {\n  this.ID = parameters.ID;\n};\n\nStore.prototype.getInfo = function (callback) {\n  if (!this.ID || !callback) {\n    if (callback) callback({\n      success: false,\n      message: 'A callback is required to get store info'\n    });\n    return;\n  }\n\n  httpJson.get(urls.store.info.replace('${storeID}', this.ID), callback);\n};\n\nStore.prototype.getMenu = function (callback, lang, noCache) {\n  if (this.cachedMenu && !noCache) {\n    callback(this.cachedMenu); //TODO as below, break compatibility by removing first parameter\n\n    return;\n  }\n\n  if (!this.ID || !callback) {\n    if (callback) callback({\n      success: false,\n      message: 'A callback is required to get a store menu'\n    });\n    return;\n  }\n\n  if (!lang) lang = 'en';\n  var url = urls.store.menu.replace('${storeID}', this.ID).replace('${lang}', lang);\n  httpJson.get(url, function (jsonObj) {\n    this.cachedMenu = new Menu(jsonObj);\n    callback(this.cachedMenu); //TODO break compatibility by removing first parameter\n  }.bind(this));\n  /*\n  httpJson.get(\n      url,\n      (function(response) {\n          fs.writeFile('sampleResp/menu'+this.ID+'.json', JSON.stringify(response, null, 4), function (err) {\n              if (err) throw err;\n              console.log('It\\'s saved!');\n          });\n      }).bind(this)\n  );\n  */\n};\n\nStore.prototype.getFriendlyNames = function (callback, lang) {\n  if (!this.ID || !callback) {\n    if (callback) callback({\n      success: false,\n      message: 'A callback is required to get a store menu'\n    });\n    return;\n  }\n\n  if (!lang) lang = 'en';\n  var url = urls.store.menu.replace('${storeID}', this.ID).replace('${lang}', lang);\n  httpJson.get(url, function (result) {\n    var itemMapping = [];\n    var keys = Object.keys(result.result.Variants);\n    keys.forEach(function (key) {\n      var json = {};\n      json[result.result.Variants[key].Name] = key;\n      itemMapping.push(json);\n    });\n    callback({\n      success: true,\n      result: itemMapping\n    });\n  });\n};\n\nmodule.exports = Store;","map":null,"metadata":{},"sourceType":"script"}