{"ast":null,"code":"'use strict';\n\nvar urls = require('./urls.json');\n\nvar request = require('request');\n\nmodule.exports.byPhone = function (phone, callback) {\n  if (!phone || !callback) {\n    if (callback) {\n      callback({\n        success: false,\n        message: 'Phone is required!'\n      });\n    }\n\n    return;\n  }\n\n  this.byUrl(urls.track + 'Phone=' + phone, callback);\n};\n\nmodule.exports.byId = function (storeID, orderKey, callback) {\n  if (!storeID || !orderKey || !callback) {\n    if (callback) callback({\n      success: false,\n      message: 'storeID, orderKey, and callback are all required to get pizza info using the orderKey'\n    });\n    return;\n  }\n\n  this.byUrl(urls.track + 'StoreID=' + storeID + '&OrderKey=' + orderKey, callback);\n};\n\nmodule.exports.byUrl = function (url, callback) {\n  request.get(url, function (error, response, body) {\n    if (error) {\n      callback({\n        success: false,\n        message: error\n      });\n      return;\n    }\n\n    if (response.statusCode !== 200) {\n      callback({\n        success: false,\n        message: 'HTML Status Code Error ' + response.statusCode\n      });\n      return;\n    }\n\n    result = parser.toJson(body, {\n      coerce: false,\n      sanitize: false,\n      object: true,\n      trim: false\n    });\n\n    if (!result['soap:Envelope']) {\n      callback({\n        success: false,\n        message: 'API soap:Envelope not present',\n        data: result\n      });\n      return;\n    }\n\n    if (!result['soap:Envelope']['soap:Body']) {\n      callback({\n        success: false,\n        message: 'API soap:Body not present',\n        data: result\n      });\n      return;\n    }\n\n    if (!result['soap:Envelope']['soap:Body'].GetTrackerDataResponse) {\n      callback({\n        success: false,\n        message: 'API GetTrackerDataResponse not present',\n        data: result\n      });\n      return;\n    }\n\n    callback({\n      orders: result['soap:Envelope']['soap:Body'].GetTrackerDataResponse.OrderStatuses,\n      query: result['soap:Envelope']['soap:Body'].GetTrackerDataResponse.Query\n    });\n  });\n};","map":null,"metadata":{},"sourceType":"script"}